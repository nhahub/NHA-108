
# ================================================
# üß© Supply Chain Analysis Project (Cleaning Part)

# Import Libraries 
import os
import pandas as pd
import numpy as np

# Load Dataset 
file_path = r"C:\Users\morom\OneDrive\Desktop\Final Project\supply_chain_data_new.csv"  
df = pd.read_csv(file_path)

print("‚úÖ Data Loaded Successfully")
print("Shape:", df.shape)
df.head()

# Standardize Column Names 
df.columns = (
    df.columns
      .str.strip()             # ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÖÿ≥ÿßŸÅÿßÿ™ ÿßŸÑÿ≤ÿßÿ¶ÿØÿ©
      .str.lower()             # ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ≠ÿ±ŸàŸÅ ÿ•ŸÑŸâ ÿµÿ∫Ÿäÿ±ÿ©
      .str.replace(" ", "_")   # ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿßŸÑŸÖÿ≥ÿßŸÅÿßÿ™ ÿ®ÿ¥ÿ±ÿ∑ÿ© ÿ≥ŸÅŸÑŸäÿ© _
)

print("\n‚úÖ Column names standardized:")
print(df.columns.tolist())

# === 4Ô∏è‚É£ Remove Duplicate Rows ===
before = df.shape[0]
df.drop_duplicates(inplace=True)
after = df.shape[0]

print(f"\n‚úÖ Removed {before - after} duplicate rows")

# === 5Ô∏è‚É£ Detect Hidden Missing Values ===
# ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÜÿµŸäÿ© ŸÖÿ´ŸÑ 'N/A' ÿ£Ÿà 'na' ÿ®ŸÄ NaN
df.replace(["N/A", "n/a", "NA", "na", "?", "None", ""], np.nan, inplace=True)

# ŸÖŸÑÿÆÿµ ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÖŸÅŸÇŸàÿØÿ©
missing_summary = df.isnull().sum()
print("\nüîç Missing Values Summary:")
print(missing_summary[missing_summary > 0])

# === 6Ô∏è‚É£ Handle Missing Values ===
# ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿ±ŸÇŸÖŸäÿ© ‚Üí ÿ®ÿßŸÑŸÄ median
# ÿßŸÑŸÇŸäŸÖ ÿßŸÑŸÜÿµŸäÿ© ‚Üí ÿ®ÿßŸÑŸÄ mode
for col in df.columns:
    if df[col].isnull().sum() > 0:
        if df[col].dtype in ["float64", "int64"]:
            df[col].fillna(df[col].median(), inplace=True)
        else:
            df[col].fillna(df[col].mode()[0], inplace=True)

print("\n‚úÖ Missing values handled.")

# === 7Ô∏è‚É£ Fix Data Types ===
# ÿßŸÑÿ™ÿ£ŸÉÿØ ÿ£ŸÜ ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ±ŸÇŸÖŸäÿ© ŸÖŸÜ ŸÜŸàÿπ ÿ±ŸÇŸÖŸä ŸÅÿπŸÑÿßŸã
numeric_cols = df.select_dtypes(include=["object"]).columns

for col in numeric_cols:
    try:
        df[col] = pd.to_numeric(df[col])
    except:
        pass

print("\n‚úÖ Data types checked and corrected where possible.")

# === 8Ô∏è‚É£ Detect and Handle Outliers ===
# ÿ∑ÿ±ŸäŸÇÿ© IQR ŸÑŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿ¥ÿßÿ∞ÿ© ŸÅŸä ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ±ŸÇŸÖŸäÿ©
numeric_columns = df.select_dtypes(include=[np.number]).columns

def remove_outliers_iqr(df, column):
    Q1 = df[column].quantile(0.25)
    Q3 = df[column].quantile(0.75)
    IQR = Q3 - Q1
    lower = Q1 - 1.5 * IQR
    upper = Q3 + 1.5 * IQR
    
    # ŸÜÿ≥ÿ™ÿÆÿØŸÖ clip ÿ®ÿØŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇŸäŸÖ ŸÑŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿπÿØÿØ ÿßŸÑÿµŸÅŸàŸÅ
    df[column] = np.clip(df[column], lower, upper)

for col in numeric_columns:
    remove_outliers_iqr(df, col)

print("\n‚úÖ Outliers capped using IQR method.")

#  Validate Business Logic 
# ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖŸÜÿ∑ŸÇ ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™: revenue ‚âà price * number_of_products_sold
df["revenue_check"] = df["price"] * df["number_of_products_sold"]

inconsistent_rows = (
    np.abs(df["revenue_generated"] - df["revenue_check"]) > 
    0.05 * df["revenue_generated"]
).sum()

print(f"\nüîç Inconsistent revenue entries: {inconsistent_rows}")

# ÿ≠ÿ∞ŸÅ ÿßŸÑÿπŸÖŸàÿØ ÿßŸÑŸÖÿ≥ÿßÿπÿØ
df.drop(columns=["revenue_check"], inplace=True, errors="ignore")

#  Save Cleaned Dataset 
cleaned_path = "supply_chain_data_cleaned.csv"
df.to_csv(cleaned_path, index=False)

print(f"\n‚úÖ Cleaned data saved as '{cleaned_path}'")
print("Final shape:", df.shape)

# Final Verification 
df.info()
df.head()

#  Confirm Save Path 
cleaned_path = os.path.join(os.getcwd(), "supply_chain_data_cleanedv2.csv")
print("‚úÖ Cleaned file saved at:", cleaned_path)


-- =========================================================
-- üìä Supply Chain KPIs Dashboard Queries (KPIS Part)
-- Table: supply_chain_data_cleanedv2
-- =========================================================

1Ô∏è‚É£ Average Execution and Manufacturing Times by Transportation Mode and Route:

SELECT 
    transportation_modes,
    routes,
    ROUND(AVG(lead_time), 2) AS Avg_Lead_Time,
    ROUND(AVG(manufacturing_lead_time), 2) AS Avg_Manufacturing_Lead_Time
FROM supply_chain_data_cleaned
GROUP BY transportation_modes, routes
ORDER BY Avg_Lead_Time DESC;


__________________________________


2Ô∏è‚É£ Total Costs and Average Cost per Transportation Mode:


SELECT 
    transportation_modes,
    ROUND(SUM(costs), 2) AS Total_Costs,
    ROUND(AVG(costs), 2) AS Avg_Cost_Per_Shipment
FROM supply_chain_data_cleaned
GROUP BY transportation_modes
ORDER BY Total_Costs DESC;



___________________________________


3Ô∏è‚É£ Total Production Volume and Average Manufacturing Cost per Location:


SELECT 
    location,
    ROUND(SUM(production_volumes), 2) AS Total_Production,
    ROUND(AVG(manufacturing_costs), 2) AS Avg_Manufacturing_Cost
FROM supply_chain_data_cleaned
GROUP BY location
ORDER BY Total_Production DESC;


___________________________________


4Ô∏è‚É£ Defect Rate (%) per Location:


SELECT 
    location,
    ROUND(AVG(defect_rates) * 100, 2) AS Avg_Defect_Rate_Percent
FROM supply_chain_data_cleaned
GROUP BY location
ORDER BY Avg_Defect_Rate_Percent DESC;


__________________________________


5Ô∏è‚É£ Inspection Pass Rate (%):


SELECT 
    ROUND(
        SUM(CASE WHEN inspection_results = 'Pass' THEN 1 ELSE 0 END) * 100.0 / COUNT(*),
        2
    ) AS Pass_Rate_Percent
FROM supply_chain_data_cleaned;


__________________________________


6Ô∏è‚É£ Performance and Cost Comparison by Route:


SELECT 
    routes,
    ROUND(AVG(costs), 2) AS Avg_Cost,
    ROUND(AVG(lead_time), 2) AS Avg_Lead_Time,
    ROUND(AVG(defect_rates) * 100, 2) AS Avg_Defect_Rate_Percent
FROM supply_chain_data_cleaned
GROUP BY routes
ORDER BY Avg_Cost DESC;


__________________________________

7Ô∏è‚É£ Top 3 Locations by Production Volume:


SELECT 
    location,
    SUM(production_volumes) AS Total_Production
FROM supply_chain_data_cleaned
GROUP BY location
ORDER BY Total_Production DESC
LIMIT 3;


__________________________________


8Ô∏è‚É£ Comprehensive Performance Analysis by Transportation Mode:


SELECT 
    transportation_modes,
    ROUND(AVG(lead_time), 2) AS Avg_Lead_Time,
    ROUND(AVG(manufacturing_costs), 2) AS Avg_Manufacturing_Cost,
    ROUND(AVG(costs), 2) AS Avg_Total_Cost,
    ROUND(AVG(defect_rates) * 100, 2) AS Avg_Defect_Rate_Percent
FROM supply_chain_data_cleaned
GROUP BY transportation_modes
ORDER BY Avg_Total_Cost DESC;

_________________________________

9Ô∏è‚É£Production Rate by Transportation Mode:

SELECT 
    transportation_modes,
    ROUND(SUM(production_volumes), 2) AS Total_Production,
    ROUND(SUM(production_volumes) / COUNT(DISTINCT sku), 2) AS Avg_Production_Per_Shipment
FROM supply_chain_data_cleanedv2
GROUP BY transportation_modes
ORDER BY Total_Production DESC;

_________________________________

üîüAverage Manufacturing Time per Product:

SELECT 
    sku AS Product_ID,
    ROUND(AVG(manufacturing_lead_time), 2) AS Avg_Manufacturing_Time
FROM supply_chain_data_cleanedv2
GROUP BY sku
ORDER BY Avg_Manufacturing_Time DESC;

______________________________

1Ô∏è‚É£1Ô∏è‚É£Top 5 Products by Defect Rate:

SELECT 
    sku AS Product_ID,
    ROUND(AVG(defect_rates) * 100, 2) AS Avg_Defect_Rate_Percent
FROM supply_chain_data_cleanedv2
GROUP BY sku
ORDER BY Avg_Defect_Rate_Percent DESC
LIMIT 5;

____________________________

1Ô∏è‚É£2Ô∏è‚É£ Average Lead Time by Supplier:

SELECT 
    supplier_name,
    ROUND(AVG(lead_times), 2) AS Avg_Supplier_Lead_Time
FROM supply_chain_data_cleanedv2
GROUP BY supplier_name
ORDER BY Avg_Supplier_Lead_Time DESC;

_____________________________

1Ô∏è‚É£3Ô∏è‚É£ Total Revenue by Product Type:

SELECT 
    product_type,
    ROUND(SUM(CAST(REPLACE(REPLACE(revenue_generated, '$', ''), ',', '') AS DECIMAL(10,2))), 2) AS Total_Revenue
FROM supply_chain_data_cleanedv2
GROUP BY product_type
ORDER BY Total_Revenue DESC;

_______________________

1Ô∏è‚É£4Ô∏è‚É£Customer demographic generates the highest average revenue per product:

SELECT
    Customer_demographics,
    COUNT(*) AS total_products,
    ROUND(AVG(Price), 2) AS avg_product_price,
    ROUND(SUM(Number_of_products_sold), 2) AS total_units_sold,
    ROUND(SUM(Price * Number_of_products_sold) / COUNT(*), 2) AS avg_revenue_per_product
FROM supply_chain_data_cleanedv2
GROUP BY Customer_demographics
ORDER BY avg_revenue_per_product DESC;

_________________________

1Ô∏è‚É£5Ô∏è‚É£Which products are the most profitable WHEN comparing selling price versus manufacturing costs?

SELECT
SKU,
Product_type,
Price,
Manufacturing_costs,
ROUND (Price Manufacturing_costs, 2) AS profit_per_unit,
ROUND(((Price Manufacturing_costs) / Price) * 100, 2) AS profit_margin_percent,
Number_of_products_sold AS units_sold,
ROUND((Price Manufacturing_costs) * Number_of_products_sold,
2) AS total_profit,
Supplier_name
FROM supply_chain_data_cleanedv2
ORDER BY profit_margin_percent DESC
LIMIT 10;

___________________________

1Ô∏è‚É£6Ô∏è‚É£ the average lead time for each supplier:

SELECT
supplier_name,
ROUND(AVG(lead_times), 2) AS avg_lead_time_days
FROM supply_chain_data_cleanedv2
GROUP BY supplier_name
ORDER BY ROUND(AVG(lead_times), 2) DESC;

___________________________

1Ô∏è‚É£7Ô∏è‚É£ Average lead and shipping times by transportation modes and routes:

SELECT transportation_modes, routes, AVG(lead_times) AS "Average Lead Times", AVG(shipping_times) AS "Average Shipping Times"
FROM supply_chain_data_cleanedv2
GROUP BY transportation_modes, routes
ORDER BY transportation_modes, routes;


